@if (selectedDoctor){
  <h2>Créneaux du docteur {{ selectedDoctor.lastName }}</h2>
}

<div class="calendar-container">
  @if (!loading && !errorMessage) {

    <!-- Navigation entre les semaines -->
    <div class="week-navigation">
      <button (click)="previousWeek()">← Semaine précédente</button>
      <span>Semaine du {{ currentWeekStart | date: 'dd/MM/yyyy' }}</span>
      <button (click)="nextWeek()">Semaine suivante →</button>
    </div>

    <!-- Grille du calendrier -->
    <div class="calendar-grid">

      <!-- En-tête : jours de la semaine -->
      <div class="grid-header">
        <div class="time-cell"></div> <!-- Cellule vide en haut à gauche -->
        @for (day of weekDays; track day) {
          <div class="day-cell">
            <strong>{{ day | date: 'EEEE' }}</strong><br>
            <span>{{ day | date: 'dd/MM/yyyy' }}</span>
          </div>
        }
      </div>

      <!-- Corps du calendrier : heures + créneaux -->
      @for (hour of hours; track hour) {
        <div class="grid-row">
          <!-- Colonne des heures -->
          <div class="time-cell">{{ hour }}</div>

          <!-- Créneaux pour chaque jour à cette heure -->
          @for (day of weekDays; track day) {
            <button
              class="slot-cell"
              [disabled]="isSlotTaken(day, hour)"
              [class.taken]="isSlotTaken(day, hour)"
              (click)="openForm(day, hour)">
              {{ isSlotTaken(day, hour) ? 'Réservé' : 'Libre' }}
            </button>
          }
        </div>
      }

      <!-- Formulaire de réservation -->
@if (selectedSlot) {
  <div class="modal-overlay">
    <div class="modal-form">
      <!-- appel closeform quand on clique sur la croix -->
      <button class="close-button" (click)="closeForm()">×</button>

      <h3>Réservation pour le {{ selectedSlot.day.toDateString() }} à {{ selectedSlot.hour }}</h3>

      <form (submit)="submitForm($event)">
        <label>
          Nom :
          <input type="text"
                 [value]="formData.lastName"
                 (input)="formData.lastName = $event.target.value"
                 required />
        </label>
        <label>
          Prénom :
          <input type="text"
                 [value]="formData.firstName"
                 (input)="formData.firstName = $event.target.value"
                 required />
        </label>
        <label>
          Âge  :
          <input type="number"
                 [value]="formData.age"
                 (input)="formData.age = $event.target.value"
                 min="0"
                 required />
        </label>
        
        <label>
          Email :
          <input type="email"
                 [value]="formData.email"
                 (input)="formData.email = $event.target.value"
                 required />
        </label>

        <label>
          Symptomes / Raison du rendez-vous :
          <input type="string"
                 [value]="formData.slotReason"
                 (input)="formData.slotReason = $event.target.value"
                 required />
        </label>

        <button type="submit" class="submit-button">Valider</button>
      </form>
      
      @if (confirmationMessage) {
        <div class="confirmation-message">
        {{ confirmationMessage }}
        <div class="progress-bar"></div>
        </div>
      }

    </div>
  </div>
}
    </div>
  }
</div>
